{% load permission_tags %}
<aside class="sidebar">
    <button type="button" class="sidebar-close-btn">
        <iconify-icon icon="radix-icons:cross-2"></iconify-icon>
    </button>
    <div>
        <a href="{% url 'index' %}" class="sidebar-logo">
            <img src="/static/images/logo-dark.png" alt="site logo" class="light-logo sidebar-open-element">
            <img src="/static/images/logo-light.png" alt="site logo" class="dark-logo sidebar-open-element">
            <img src="/static/images/dark-icon.png" alt="site logo" class="dark-icon sidebar-close-element" style="display: none;">
            <img src="/static/images/light-icon.png" alt="site logo" class="light-icon sidebar-close-element" style="display: none;">
        </a>
    </div>
    <div class="sidebar-menu-area">
        <ul class="sidebar-menu" id="sidebar-menu">
            <li>
                <a href="{% url 'dashboard' %}">
                    <iconify-icon icon="solar:home-smile-angle-bold" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.dashboard">Dashboard</span>
                </a>
            </li>
            
            <!-- Organizations Menu - visible based on role -->
            {% is_at_least 'owner' as is_owner_plus %}
            {% if is_owner_plus %}
            <li class="dropdown">
                <a href="javascript:void(0)">
                    <iconify-icon icon="mdi:domain" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.organization">Organization</span>
                </a>
                <ul class="sidebar-submenu">
                    <li>
                        <a href="{% url 'center_list' %}"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> <span data-i18n="sidebar.centers">Companies</span></a>
                    </li>
                    <li>
                        <a href="{% url 'branch_list' %}"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> <span data-i18n="sidebar.branches">Branches</span></a>
                    </li>
                    {% has_any_perm 'can_manage_staff,can_view_staff' as can_view_staff_menu %}
                    {% if can_view_staff_menu %}
                    <li>
                        <a href="{% url 'staff_list' %}"><i class="ri-circle-fill circle-icon text-success-main w-auto"></i> <span data-i18n="sidebar.staff">Staff</span></a>
                    </li>
                    {% endif %}
                    {% is_role 'superuser' as is_super %}
                    {% if is_super %}
                    <li>
                        <a href="{% url 'role_list' %}"><i class="ri-circle-fill circle-icon text-warning-main w-auto"></i> <span data-i18n="sidebar.rolesPermissions">Roles & Permissions</span></a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% else %}
            {% has_any_perm 'can_view_staff,can_manage_staff' as can_staff_section %}
            {% has_any_perm 'can_view_branch_settings,can_manage_branch_settings' as can_settings_section %}
            {% if is_manager or can_staff_section or can_settings_section %}
            <li class="dropdown">
                <a href="javascript:void(0)">
                    <iconify-icon icon="mdi:domain" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.myBranch">My Branch</span>
                </a>
                <ul class="sidebar-submenu">
                    <li>
                        <a href="{% url 'branch_list' %}"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> <span data-i18n="sidebar.branchInfo">Branch Info</span></a>
                    </li>
                    {% if can_staff_section %}
                    <li>
                        <a href="{% url 'staff_list' %}"><i class="ri-circle-fill circle-icon text-success-main w-auto"></i> <span data-i18n="sidebar.staff">Staff</span></a>
                    </li>
                    {% endif %}
                    {% if can_settings_section %}
                    <li>
                        <a href="{% url 'branch_list' %}"><i class="ri-circle-fill circle-icon text-warning-main w-auto"></i> <span data-i18n="sidebar.branchSettings">Bot Settings</span></a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}
            {% endif %}
            
            <li>
                <a href="{% url 'usersList' %}">
                    <iconify-icon icon="solar:users-group-rounded-bold" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.users">Customers</span>
                </a>
            </li>
             <li>
                <a href="{% url 'orders:ordersList' %}">
                    <iconify-icon icon="solar:bag-4-bold" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.orders">Orders</span>
                </a>
            </li>
            
            {% has_any_perm 'can_view_products,can_manage_products,can_view_expenses,can_manage_expenses' as can_services %}
            {% if can_services %}
            <li class="dropdown">
                <a href="javascript:void(0)">
                    <iconify-icon icon="solar:star-bold" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.services">Services</span>
                </a>
                <ul class="sidebar-submenu">
                    {% can_do 'products.view' as can_view_products %}
                    {% if can_view_products %}
                    <li>
                        <a href="{% url 'categoryList' %}"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> <span data-i18n="sidebar.categories">Categories</span></a>
                    </li>
                    <li>
                        <a href="{% url 'productList' %}"><i class="ri-circle-fill circle-icon text-warning-main w-auto"></i> <span data-i18n="sidebar.products">Products</span></a>
                    </li>
                    {% endif %}
                    {% can_do 'expenses.view' as can_view_expenses %}
                    {% if can_view_expenses %}
                    <li>
                        <a href="{% url 'expenseList' %}"><i class="ri-circle-fill circle-icon text-danger-main w-auto"></i> <span>Expenses</span></a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}
            
            <!-- Analytics Section - Permission-based visibility -->
            {% has_any_perm 'can_view_reports,can_view_analytics,can_view_financial_reports' as can_any_reports %}
            {% if can_any_reports or is_staff_member %}
            <li class="sidebar-menu-group-title" data-i18n="sidebar.analyticsReports">Analytics & Reports</li>
            
            <!-- My Statistics - Visible to all staff members (their own stats) -->
            {% if is_staff_member %}
            <li>
                <a href="{% url 'my_statistics' %}">
                    <iconify-icon icon="solar:chart-bold" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.myStatistics">My Statistics</span>
                </a>
            </li>
            {% endif %}
            
            <!-- Sales & Finance Dashboards - Permission-based -->
            {% has_any_perm 'can_view_reports,can_view_analytics' as can_dashboards %}
            {% if can_dashboards %}
            <li class="dropdown">
                <a href="javascript:void(0)">
                    <iconify-icon icon="solar:wallet-money-bold-duotone" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.dashboards">Dashboards</span>
                </a>
                <ul class="sidebar-submenu">
                    {% can_do 'reports.view' as can_sales %}
                    {% if can_sales %}
                    <li>
                        <a href="{% url 'sales' %}"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> <span data-i18n="sidebar.salesDashboard">Sales Overview</span></a>
                    </li>
                    {% endif %}
                    {% has_any_perm 'can_view_financial_reports,can_view_analytics' as can_finance %}
                    {% if can_finance %}
                    <li>
                        <a href="{% url 'finance' %}"><i class="ri-circle-fill circle-icon text-success-main w-auto"></i> <span data-i18n="sidebar.financeDashboard">Finance & Payments</span></a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}
            
            <!-- Detailed Reports - Permission-based -->
            {% if can_any_reports %}
            <li class="dropdown">
                <a href="javascript:void(0)">
                    <iconify-icon icon="solar:chart-square-bold-duotone" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.reports">Reports</span>
                </a>
                <ul class="sidebar-submenu">
                    {% can_do 'reports.financial' as can_financial %}
                    {% if can_financial %}
                    <li>
                        <a href="{% url 'financial_reports' %}"><i class="ri-circle-fill circle-icon text-success-main w-auto"></i> <span data-i18n="sidebar.financialReports">Financial Reports</span></a>
                    </li>
                    <li>
                        <a href="{% url 'unit_economy' %}"><i class="ri-circle-fill circle-icon text-danger-main w-auto"></i> <span data-i18n="sidebar.unitEconomy">Unit Economy</span></a>
                    </li>
                    {% endif %}
                    {% can_do 'reports.view' as can_order_reports %}
                    {% if can_order_reports %}
                    <li>
                        <a href="{% url 'order_reports' %}"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> <span data-i18n="sidebar.orderReports">Order Reports</span></a>
                    </li>
                    <li>
                        <a href="{% url 'staff_performance' %}"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> <span data-i18n="sidebar.staffPerformance">Staff Performance</span></a>
                    </li>
                    {% endif %}
                    {% can_do 'analytics.view' as can_analytics %}
                    {% if can_analytics %}
                    <li>
                        <a href="{% url 'branch_comparison' %}"><i class="ri-circle-fill circle-icon text-warning-main w-auto"></i> <span data-i18n="sidebar.branchComparison">Branch Comparison</span></a>
                    </li>
                    {% endif %}
                    {% has_any_perm 'can_view_analytics,can_view_customer_details' as can_customer_analytics %}
                    {% if can_customer_analytics %}
                    <li>
                        <a href="{% url 'customer_analytics' %}"><i class="ri-circle-fill circle-icon text-danger-main w-auto"></i> <span data-i18n="sidebar.customerAnalytics">Customer Analytics</span></a>
                    </li>
                    {% endif %}
                    {% has_any_perm 'can_view_audit_logs' as can_audit_logs %}
                    {% if can_audit_logs or is_owner or user.is_superuser %}
                    <li>
                        <a href="{% url 'audit_logs' %}"><i class="ri-circle-fill circle-icon text-secondary-main w-auto"></i> <span data-i18n="sidebar.auditLogs">Audit Logs</span></a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}
            {% endif %}
            
            <!-- Marketing & Broadcasts - Permission-based -->
            {% has_any_perm 'can_manage_marketing,can_create_marketing_posts,can_send_branch_broadcasts,can_send_center_broadcasts,can_view_broadcast_stats' as can_marketing %}
            {% if can_marketing or is_owner %}
            <li>
                <a href="{% url 'marketing_list' %}">
                    <iconify-icon icon="solar:chat-round-call-bold" class="menu-icon"></iconify-icon>
                    <span data-i18n="sidebar.marketing">Marketing</span>
                </a>
            </li>
            {% endif %}

        </ul>
    </div>
</aside>