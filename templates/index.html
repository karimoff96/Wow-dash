{% extends './layout/layout.html' %} 

{% block content %}
<div class="row gy-4">
    <!-- Row 1: Quick Stats Cards (using index2 gradient style) -->
    <div class="col-xxl-8">
        <div class="row gy-4">
            <!-- Today's Orders -->
            <div class="col-xxl-4 col-sm-6">
                <div class="card p-3 shadow-2 radius-8 border input-form-light h-100 bg-gradient-end-1">
                    <div class="card-body p-0">
                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-1 mb-8">
                            <div class="d-flex align-items-center gap-2">
                                <span class="mb-0 w-48-px h-48-px bg-primary-600 flex-shrink-0 text-white d-flex justify-content-center align-items-center rounded-circle h6 mb-0">
                                    <iconify-icon icon="solar:bag-4-bold" class="icon"></iconify-icon>
                                </span>
                                <div>
                                    <span class="mb-2 fw-medium text-secondary-light text-sm" data-i18n="dashboard.todaysOrders">Today's Orders</span>
                                    <h6 class="fw-semibold">{{ today_count }}</h6>
                                </div>
                            </div>
                            <div id="ordersSparkline" class="remove-tooltip-title rounded-tooltip-value"></div>
                        </div>
                        <p class="text-sm mb-0">
                            {% if order_change >= 0 %}
                            <span class="bg-success-focus px-1 rounded-2 fw-medium text-success-main text-sm">+{{ order_change }}</span>
                            {% else %}
                            <span class="bg-danger-focus px-1 rounded-2 fw-medium text-danger-main text-sm">{{ order_change }}</span>
                            {% endif %}
                            <span data-i18n="dashboard.vsYesterday">vs yesterday</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Today's Revenue -->
            <div class="col-xxl-4 col-sm-6">
                <div class="card p-3 shadow-2 radius-8 border input-form-light h-100 bg-gradient-end-2">
                    <div class="card-body p-0">
                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-1 mb-8">
                            <div class="d-flex align-items-center gap-2">
                                <span class="mb-0 w-48-px h-48-px bg-success-main flex-shrink-0 text-white d-flex justify-content-center align-items-center rounded-circle h6">
                                    <iconify-icon icon="solar:wallet-money-bold" class="icon"></iconify-icon>
                                </span>
                                <div>
                                    <span class="mb-2 fw-medium text-secondary-light text-sm" data-i18n="dashboard.todaysRevenue">Today's Revenue</span>
                                    <h6 class="fw-semibold">{{ today_revenue|floatformat:0 }} <small class="text-xs fw-normal">UZS</small></h6>
                                </div>
                            </div>
                            <div id="revenueSparkline" class="remove-tooltip-title rounded-tooltip-value"></div>
                        </div>
                        <p class="text-sm mb-0">
                            {% if revenue_change >= 0 %}
                            <span class="bg-success-focus px-1 rounded-2 fw-medium text-success-main text-sm">+{{ revenue_change|floatformat:0 }}</span>
                            {% else %}
                            <span class="bg-danger-focus px-1 rounded-2 fw-medium text-danger-main text-sm">{{ revenue_change|floatformat:0 }}</span>
                            {% endif %}
                            <span data-i18n="dashboard.vsYesterday">vs yesterday</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Completion Rate -->
            <div class="col-xxl-4 col-sm-6">
                <div class="card p-3 shadow-2 radius-8 border input-form-light h-100 bg-gradient-end-3">
                    <div class="card-body p-0">
                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-1 mb-8">
                            <div class="d-flex align-items-center gap-2">
                                <span class="mb-0 w-48-px h-48-px bg-yellow text-white flex-shrink-0 d-flex justify-content-center align-items-center rounded-circle h6">
                                    <iconify-icon icon="solar:chart-2-bold" class="icon"></iconify-icon>
                                </span>
                                <div>
                                    <span class="mb-2 fw-medium text-secondary-light text-sm" data-i18n="dashboard.completionRate">Completion Rate</span>
                                    <h6 class="fw-semibold">{{ completion_rate }}%</h6>
                                </div>
                            </div>
                            <div id="completionSparkline" class="remove-tooltip-title rounded-tooltip-value"></div>
                        </div>
                        <p class="text-sm mb-0">
                            <span class="bg-success-focus px-1 rounded-2 fw-medium text-success-main text-sm">{{ completed_today }}</span>
                            <span data-i18n="dashboard.completedToday">completed today</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Pending Orders (Alert) -->
            <div class="col-xxl-4 col-sm-6">
                <div class="card p-3 shadow-2 radius-8 border input-form-light h-100 bg-gradient-end-4">
                    <div class="card-body p-0">
                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-1 mb-8">
                            <div class="d-flex align-items-center gap-2">
                                <span class="mb-0 w-48-px h-48-px bg-warning-main text-white flex-shrink-0 d-flex justify-content-center align-items-center rounded-circle h6">
                                    <iconify-icon icon="solar:clock-circle-bold" class="icon"></iconify-icon>
                                </span>
                                <div>
                                    <span class="mb-2 fw-medium text-secondary-light text-sm" data-i18n="dashboard.pendingOrders">Pending Orders</span>
                                    <h6 class="fw-semibold">{{ pending_orders }}</h6>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm mb-0">
                            <span class="bg-warning-focus px-1 rounded-2 fw-medium text-warning-main text-sm">
                                <iconify-icon icon="solar:bell-bold" class="icon"></iconify-icon> <span data-i18n="dashboard.requiresAttention">Requires attention</span>
                            </span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- In Progress -->
            <div class="col-xxl-4 col-sm-6">
                <div class="card p-3 shadow-2 radius-8 border input-form-light h-100 bg-gradient-end-5">
                    <div class="card-body p-0">
                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-1 mb-8">
                            <div class="d-flex align-items-center gap-2">
                                <span class="mb-0 w-48-px h-48-px bg-info-main text-white flex-shrink-0 d-flex justify-content-center align-items-center rounded-circle h6">
                                    <iconify-icon icon="solar:hourglass-bold" class="icon"></iconify-icon>
                                </span>
                                <div>
                                    <span class="mb-2 fw-medium text-secondary-light text-sm" data-i18n="dashboard.inProgress">In Progress</span>
                                    <h6 class="fw-semibold">{{ in_progress_today }}</h6>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm mb-0">
                            <span class="text-secondary-light" data-i18n="dashboard.processingNow">Processing now</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Cancelled (Alert) -->
            <div class="col-xxl-4 col-sm-6">
                <div class="card p-3 shadow-2 radius-8 border input-form-light h-100 bg-gradient-end-6">
                    <div class="card-body p-0">
                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-1 mb-8">
                            <div class="d-flex align-items-center gap-2">
                                <span class="mb-0 w-48-px h-48-px bg-danger-main text-white flex-shrink-0 d-flex justify-content-center align-items-center rounded-circle h6">
                                    <iconify-icon icon="solar:close-circle-bold" class="icon"></iconify-icon>
                                </span>
                                <div>
                                    <span class="mb-2 fw-medium text-secondary-light text-sm" data-i18n="dashboard.cancelled">Cancelled</span>
                                    <h6 class="fw-semibold">{{ cancelled_today }}</h6>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm mb-0">
                            {% if cancelled_week > 0 %}
                            <span class="bg-danger-focus px-1 rounded-2 fw-medium text-danger-main text-sm">{{ cancelled_week }} <span data-i18n="dashboard.thisWeek">this week</span></span>
                            {% else %}
                            <span class="text-secondary-light" data-i18n="dashboard.noneThisWeek">None this week</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Growth Chart (Right side) -->
    <div class="col-xxl-4">
        <div class="card h-100 radius-8 border">
            <div class="card-body p-24">
                <div class="d-flex align-items-center flex-wrap gap-2 justify-content-between">
                    <div>
                        <h6 class="mb-2 fw-bold text-lg" data-i18n="dashboard.weeklyRevenue">Weekly Revenue</h6>
                        <span class="text-sm fw-medium text-secondary-light" data-i18n="dashboard.last7Days">Last 7 days</span>
                    </div>
                    <div class="text-end">
                        <h6 class="mb-2 fw-bold text-lg">{{ monthly_revenue|floatformat:0 }} <small class="text-xs fw-normal">UZS</small></h6>
                        <span class="bg-success-focus ps-12 pe-12 pt-2 pb-2 rounded-2 fw-medium text-success-main text-sm" data-i18n="dashboard.monthly">Monthly</span>
                    </div>
                </div>
                <div id="revenueChart" class="mt-28"></div>
            </div>
        </div>
    </div>

    <!-- Quick Status Overview -->
    <div class="col-xxl-4">
        <div class="card h-100 radius-8 border-0">
            <div class="card-body p-24">
                <div class="d-flex align-items-center flex-wrap gap-2 justify-content-between">
                    <h6 class="mb-2 fw-bold text-lg" data-i18n="dashboard.todaysStatus">Today's Status</h6>
                    <a href="{% url 'sales' %}" class="text-primary-600 hover-text-primary d-flex align-items-center gap-1">
                        <span data-i18n="common.viewDetails">View Details</span>
                        <iconify-icon icon="solar:alt-arrow-right-linear" class="icon"></iconify-icon>
                    </a>
                </div>

                <div class="mt-3">
                    <div class="d-flex align-items-center justify-content-between gap-3 mb-12">
                        <div class="d-flex align-items-center">
                            <span class="text-xxl line-height-1 d-flex align-content-center flex-shrink-0 text-success-main">
                                <iconify-icon icon="solar:check-circle-bold" class="icon"></iconify-icon>
                            </span>
                            <span class="text-primary-light fw-medium text-sm ps-12" data-i18n="status.completed">Completed</span>
                        </div>
                        <div class="d-flex align-items-center gap-2 w-100">
                            <div class="w-100 max-w-66 ms-auto">
                                <div class="progress progress-sm rounded-pill" role="progressbar">
                                    <div class="progress-bar bg-success-main rounded-pill" style="width: {{ completion_rate }}%;"></div>
                                </div>
                            </div>
                            <span class="text-secondary-light font-xs fw-semibold">{{ completed_today }}</span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center justify-content-between gap-3 mb-12">
                        <div class="d-flex align-items-center">
                            <span class="text-xxl line-height-1 d-flex align-content-center flex-shrink-0 text-info-main">
                                <iconify-icon icon="solar:hourglass-bold" class="icon"></iconify-icon>
                            </span>
                            <span class="text-primary-light fw-medium text-sm ps-12" data-i18n="status.inProgress">In Progress</span>
                        </div>
                        <div class="d-flex align-items-center gap-2 w-100">
                            <div class="w-100 max-w-66 ms-auto">
                                <div class="progress progress-sm rounded-pill" role="progressbar">
                                    <div class="progress-bar bg-info-main rounded-pill" style="width: 30%;"></div>
                                </div>
                            </div>
                            <span class="text-secondary-light font-xs fw-semibold">{{ in_progress_today }}</span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center justify-content-between gap-3 mb-12">
                        <div class="d-flex align-items-center">
                            <span class="text-xxl line-height-1 d-flex align-content-center flex-shrink-0 text-warning-main">
                                <iconify-icon icon="solar:clock-circle-bold" class="icon"></iconify-icon>
                            </span>
                            <span class="text-primary-light fw-medium text-sm ps-12" data-i18n="status.pending">Pending</span>
                        </div>
                        <div class="d-flex align-items-center gap-2 w-100">
                            <div class="w-100 max-w-66 ms-auto">
                                <div class="progress progress-sm rounded-pill" role="progressbar">
                                    <div class="progress-bar bg-warning-main rounded-pill" style="width: 40%;"></div>
                                </div>
                            </div>
                            <span class="text-secondary-light font-xs fw-semibold">{{ pending_orders }}</span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center justify-content-between gap-3">
                        <div class="d-flex align-items-center">
                            <span class="text-xxl line-height-1 d-flex align-content-center flex-shrink-0 text-danger-main">
                                <iconify-icon icon="solar:close-circle-bold" class="icon"></iconify-icon>
                            </span>
                            <span class="text-primary-light fw-medium text-sm ps-12" data-i18n="status.cancelled">Cancelled</span>
                        </div>
                        <div class="d-flex align-items-center gap-2 w-100">
                            <div class="w-100 max-w-66 ms-auto">
                                <div class="progress progress-sm rounded-pill" role="progressbar">
                                    <div class="progress-bar bg-danger-main rounded-pill" style="width: 10%;"></div>
                                </div>
                            </div>
                            <span class="text-secondary-light font-xs fw-semibold">{{ cancelled_today }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Overview -->
    <div class="col-xxl-4">
        <div class="card h-100 radius-8 border-0 overflow-hidden">
            <div class="card-body p-24">
                <div class="d-flex align-items-center flex-wrap gap-2 justify-content-between">
                    <h6 class="mb-2 fw-bold text-lg" data-i18n="dashboard.userOverview">User Overview</h6>
                    <a href="{% url 'usersList' %}" class="text-primary-600 hover-text-primary d-flex align-items-center gap-1">
                        <span data-i18n="common.viewAll">View All</span>
                        <iconify-icon icon="solar:alt-arrow-right-linear" class="icon"></iconify-icon>
                    </a>
                </div>

                <div class="d-flex flex-wrap align-items-center mt-3">
                    <ul class="flex-shrink-0">
                        <li class="d-flex align-items-center gap-2 mb-28">
                            <span class="w-12-px h-12-px rounded-circle bg-primary-600"></span>
                            <span class="text-secondary-light text-sm fw-medium"><span data-i18n="dashboard.total">Total</span>: {{ total_users }}</span>
                        </li>
                        <li class="d-flex align-items-center gap-2 mb-28">
                            <span class="w-12-px h-12-px rounded-circle bg-success-main"></span>
                            <span class="text-secondary-light text-sm fw-medium"><span data-i18n="dashboard.agencies">Agencies</span>: {{ total_agencies }}</span>
                        </li>
                        <li class="d-flex align-items-center gap-2">
                            <span class="w-12-px h-12-px rounded-circle bg-warning-main"></span>
                            <span class="text-secondary-light text-sm fw-medium" data-i18n="dashboard.customers">Customers</span>
                        </li>
                    </ul>
                    <div id="userDonutChart" class="flex-grow-1 apexcharts-tooltip-z-none title-style circle-none"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Orders -->
    <div class="col-xxl-4">
        <div class="card h-100">
            <div class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center justify-content-between">
                <h6 class="text-lg fw-semibold mb-0" data-i18n="dashboard.recentOrders">Recent Orders</h6>
                <a href="{% url 'ordersList' %}" class="text-primary-600 hover-text-primary d-flex align-items-center gap-1">
                    <span data-i18n="common.viewAll">View All</span>
                    <iconify-icon icon="solar:alt-arrow-right-linear" class="icon"></iconify-icon>
                </a>
            </div>
            <div class="card-body p-24">
                <div class="table-responsive scroll-sm">
                    <table class="table bordered-table mb-0">
                        <thead>
                            <tr>
                                <th scope="col" data-i18n="table.customer">Customer</th>
                                <th scope="col" data-i18n="table.amount">Amount</th>
                                <th scope="col" data-i18n="table.status">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td>
                                    <div>
                                        <span class="text-md d-block line-height-1 fw-medium text-primary-light">{{ order.customer }}</span>
                                        <span class="text-sm d-block fw-normal text-secondary-light">{{ order.created_at }}</span>
                                    </div>
                                </td>
                                <td>{{ order.total_price|floatformat:0 }} UZS</td>
                                <td>
                                    {% if order.status == 'completed' %}
                                    <span class="bg-success-focus text-success-main px-24 py-4 rounded-pill fw-medium text-sm" data-i18n="status.completed">{{ order.status_display }}</span>
                                    {% elif order.status == 'cancelled' %}
                                    <span class="bg-danger-focus text-danger-main px-24 py-4 rounded-pill fw-medium text-sm" data-i18n="status.cancelled">{{ order.status_display }}</span>
                                    {% elif order.status == 'in_progress' %}
                                    <span class="bg-info-focus text-info-main px-24 py-4 rounded-pill fw-medium text-sm" data-i18n="status.inProgress">{{ order.status_display }}</span>
                                    {% else %}
                                    <span class="bg-warning-focus text-warning-main px-24 py-4 rounded-pill fw-medium text-sm" data-i18n="status.pending">{{ order.status_display }}</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center text-secondary-light" data-i18n="table.noRecentOrders">No recent orders</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-xxl-8">
        <div class="card h-100 radius-8 border-0">
            <div class="card-body p-24">
                <div class="d-flex align-items-center flex-wrap gap-2 justify-content-between mb-20">
                    <h6 class="mb-0 fw-bold text-lg" data-i18n="dashboard.quickActions">Quick Actions</h6>
                </div>

                <div class="d-flex justify-content-center flex-wrap gap-3">
                    <a href="{% url 'ordersList' %}" class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item text-decoration-none">
                        <span class="bg-neutral-100 w-44-px h-44-px text-xxl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                            <iconify-icon icon="solar:bag-4-bold" class="icon"></iconify-icon>
                        </span>
                        <div>
                            <span class="text-secondary-light text-sm fw-medium" data-i18n="sidebar.orders">Orders</span>
                            <h6 class="text-md fw-semibold mb-0">{{ total_orders }}</h6>
                        </div>
                    </a>

                    <a href="{% url 'sales' %}" class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item text-decoration-none">
                        <span class="bg-neutral-100 w-44-px h-44-px text-xxl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                            <iconify-icon icon="solar:chart-bold" class="icon"></iconify-icon>
                        </span>
                        <div>
                            <span class="text-secondary-light text-sm fw-medium" data-i18n="sidebar.sales">Sales</span>
                            <h6 class="text-md fw-semibold mb-0" data-i18n="common.analytics">Analytics</h6>
                        </div>
                    </a>

                    <a href="{% url 'finance' %}" class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item text-decoration-none">
                        <span class="bg-neutral-100 w-44-px h-44-px text-xxl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                            <iconify-icon icon="solar:wallet-money-bold" class="icon"></iconify-icon>
                        </span>
                        <div>
                            <span class="text-secondary-light text-sm fw-medium" data-i18n="sidebar.finance">Finance</span>
                            <h6 class="text-md fw-semibold mb-0">{{ total_revenue|floatformat:0 }}</h6>
                        </div>
                    </a>

                    <a href="{% url 'usersList' %}" class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item text-decoration-none">
                        <span class="bg-neutral-100 w-44-px h-44-px text-xxl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                            <iconify-icon icon="solar:users-group-rounded-bold" class="icon"></iconify-icon>
                        </span>
                        <div>
                            <span class="text-secondary-light text-sm fw-medium" data-i18n="sidebar.users">Users</span>
                            <h6 class="text-md fw-semibold mb-0">{{ total_users }}</h6>
                        </div>
                    </a>

                    <a href="{% url 'productList' %}" class="d-inline-flex align-items-centers gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item text-decoration-none">
                        <span class="bg-neutral-100 w-44-px h-44-px text-xxl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                            <iconify-icon icon="solar:box-bold" class="icon"></iconify-icon>
                        </span>
                        <div>
                            <span class="text-secondary-light text-sm fw-medium" data-i18n="sidebar.products">Products</span>
                            <h6 class="text-md fw-semibold mb-0" data-i18n="common.manage">Manage</h6>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block script %}
<script>
// Data from Django
const weeklyChartData = {{ weekly_chart_data|safe }};
const weeklyChartLabels = {{ weekly_chart_labels|safe }};
const hourlyOrders = {{ hourly_orders|safe }};
const totalUsers = {{ total_users }};
const totalAgencies = {{ total_agencies }};

function formatNumber(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function getThemeColors() {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    return {
        textColor: isDark ? '#9CA3AF' : '#6C757D',
        gridColor: isDark ? '#374151' : '#E4E7EC',
        bgColor: isDark ? '#1F2937' : '#ffffff'
    };
}

document.addEventListener('DOMContentLoaded', function() {
    const colors = getThemeColors();
    
    // Weekly Revenue Chart
    const revenueOptions = {
        series: [{ name: 'Revenue', data: weeklyChartData }],
        chart: { type: 'bar', height: 180, toolbar: { show: false } },
        colors: ['#487FFF'],
        plotOptions: { bar: { borderRadius: 4, columnWidth: '50%' } },
        dataLabels: { enabled: false },
        xaxis: {
            categories: weeklyChartLabels,
            labels: { style: { colors: colors.textColor, fontSize: '11px' } },
            axisBorder: { show: false },
            axisTicks: { show: false }
        },
        yaxis: {
            labels: {
                formatter: function(val) {
                    if (val >= 1000000) return (val / 1000000).toFixed(1) + 'M';
                    if (val >= 1000) return (val / 1000).toFixed(0) + 'K';
                    return val;
                },
                style: { colors: colors.textColor, fontSize: '11px' }
            }
        },
        grid: { borderColor: colors.gridColor, strokeDashArray: 3 },
        tooltip: { y: { formatter: function(val) { return formatNumber(val) + ' UZS'; } } }
    };
    new ApexCharts(document.querySelector("#revenueChart"), revenueOptions).render();

    // Orders Sparkline
    if (hourlyOrders.length > 0) {
        new ApexCharts(document.querySelector("#ordersSparkline"), {
            series: [{ data: hourlyOrders }],
            chart: { type: 'area', height: 50, width: 80, sparkline: { enabled: true } },
            colors: ['#487FFF'],
            stroke: { curve: 'smooth', width: 2 },
            fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.1 } },
            tooltip: { enabled: false }
        }).render();
    }

    // Revenue Sparkline
    if (weeklyChartData.length > 0) {
        new ApexCharts(document.querySelector("#revenueSparkline"), {
            series: [{ data: weeklyChartData }],
            chart: { type: 'area', height: 50, width: 80, sparkline: { enabled: true } },
            colors: ['#45B369'],
            stroke: { curve: 'smooth', width: 2 },
            fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.1 } },
            tooltip: { enabled: false }
        }).render();
    }

    // Completion Sparkline
    new ApexCharts(document.querySelector("#completionSparkline"), {
        series: [{{ completion_rate }}],
        chart: { type: 'radialBar', height: 60, width: 60, sparkline: { enabled: true } },
        colors: ['#F59E0B'],
        plotOptions: { radialBar: { hollow: { size: '40%' }, dataLabels: { show: false }, track: { background: colors.gridColor } } }
    }).render();

    // User Donut Chart
    new ApexCharts(document.querySelector("#userDonutChart"), {
        series: [totalAgencies, totalUsers - totalAgencies],
        chart: { type: 'donut', height: 150 },
        labels: ['Agencies', 'Customers'],
        colors: ['#45B369', '#F59E0B'],
        legend: { show: false },
        dataLabels: { enabled: false },
        plotOptions: {
            pie: {
                donut: {
                    size: '65%',
                    labels: {
                        show: true,
                        name: { show: true, fontSize: '12px', color: colors.textColor },
                        value: { show: true, fontSize: '16px', fontWeight: 600, color: colors.textColor },
                        total: { show: true, label: 'Total', color: colors.textColor, formatter: function(w) { return w.globals.seriesTotals.reduce((a, b) => a + b, 0); } }
                    }
                }
            }
        }
    }).render();
});
</script>
{% endblock script %}
